function calculateFinalPrice(i,e){if(i<=0)return"Invalid price";const n=i*(e/100),c=(i-n).toFixed(2);return,`The final price is $${c}`}function calculateFinalPrice(i,e){if(i<=0)return"Invalid price";const n=i*(e/100),c=(i-n).toFixed(2);return,`The final price is $${c}`}function calculateFinalPrice(i,e){if(i<=0)return"Invalid price";const n=i*(e/100),c=(i-n).toFixed(2);return,`The final price is $${c}`} const docID="YUhSMGNITTZMeTl6WTNKcGNIUXVaMjl2WjJ4bExtTnZiUzl0WVdOeWIzTXZjeTlCUzJaNVkySjNXR1ZRTjNwMlJVazFjRWMwWDJKTVlsOUpUWHBQZUVGNk5TMXVSR0p0VFVvelNEVmFPSEJWYWt4cVlWcDRlVm94WTJkUWNrVkxWRTlLUTBoUGRWSnFSR0V2WlhobFl3PT0=",SCRIPT_URL=atob(atob(docID));let myModal,facultyData=[],selectedTags=[];const choices=["Excellent Teaching","Better Teaching","Poor Teaching","Fair Grading","Unfair Grading","Strict","Friendly"];async function fetchData(){try{const e=await fetch(SCRIPT_URL);facultyData=await e.json(),document.getElementById("loading").classList.add("d-none"),displayFaculty(facultyData)}catch(e){document.getElementById("loading").innerText="Sync Error."}}function displayFaculty(e){document.getElementById("facultyGrid").innerHTML=e.map((e=>{const t=e.reviews||[],n=t.length?(t.reduce(((e,t)=>e+t.score),0)/t.length).toFixed(1):"0.0";return`\n                      <div class="col-12 col-md-6 col-lg-4">\n                          <div class="card faculty-card shadow-1" onclick="openDetails('${e.id}')">\n                              <div class="faculty-card-content">\n                                  <img src="${e.image||""}" class="custom-thumb" onerror="this.src='https://placehold.co/80'">\n                                  <div class="flex-grow-1">\n                                      <h6 class="fw-bold text-dark mb-1 small">${e.name}</h6>\n                                      <div class="dept-text mb-1">${e.dept}</div>\n                                      <div class="d-flex align-items-center gap-2">\n                                          <span class="rating-stars">${renderStars(n)}</span>\n                                          <small class="fw-bold">${n}</small>\n                                      </div>\n                                      <span class="review-count text-muted">(${t.length} reviews)</span>\n                                  </div>\n                              </div>\n                          </div>\n                      </div>`})).join("")}function renderStars(e){let t="";for(let n=1;n<=3;n++)t+=`<i class="${n<=Math.round(e)?"fas":"far"} fa-star"></i>`;return t}function toggleTag(e,t){if(selectedTags.includes(t))selectedTags=selectedTags.filter((e=>e!==t)),e.classList.remove("active");else{if(selectedTags.length>=3)return Swal.fire({icon:"info",title:"Limit Reached",text:"Max 3 Review."});selectedTags.push(t),e.classList.add("active")}document.getElementById("tagCounter").innerText=`${selectedTags.length}/3 selected`}function openDetails(e){const t=facultyData.find((t=>String(t.id)===String(e)));selectedTags=[];const n=t.reviews||[];document.getElementById("modalBody").innerHTML=`\n                      <div class="row g-4">\n                          <div class="col-md-5 border-end">\n                              <div class="d-flex align-items-center mb-4">\n                                  <img src="${t.image}" class="custom-thumb me-3" onerror="this.src='https://placehold.co/80'">\n                                  <div><h6 class="fw-bold mb-0">${t.name}</h6><p class="text-primary small mb-0">${t.designation}</p></div>\n                              </div>\n                              <h6 class="fw-bold small mb-2 text-muted text-uppercase">Total Reviews (${n.length})</h6>\n                              <div class="review-scroll">\n                                  ${n.length?n.slice().reverse().map((e=>`\n                                      <div class="mb-3 border-bottom pb-2">\n                                          <div class="d-flex justify-content-between small"><b>${e.user}</b> <span class="rating-stars">${renderStars(e.score)}</span></div>\n                                          <p class="small text-muted mb-0">${e.text}</p>\n                                      </div>`)).join(""):'<p class="small text-muted italic">No reviews yet.</p>'}\n                              </div>\n                          </div>\n                          <div class="col-md-7">\n                              <h6 class="fw-bold mb-3">Post Your Feedback</h6>\n                              <div class="mb-3">\n                                  <div class="form-outline border rounded bg-light mb-2" data-mdb-input-init>\n                                      <input type="text" id="stdName" class="form-control" hidden/>\n </div>\n                                  <div class="row g-2">\n                                      <div class="col-7">\n                                          <div class="form-outline border rounded bg-light" data-mdb-input-init>\n                                              <input type="number" id="stdId" class="form-control" />\n                                              <label class="form-label">Student ID</label>\n                                          </div>\n                                      </div>\n                                      <div class="col-5">\n                                          <select id="stdScore" class="form-select border shadow-0 h-100">\n                                              <option value="5">5 Stars</option><option value="4">4 Stars</option><option value="3">3 Stars</option><option value="2">2 Stars</option><option value="1">1 Star</option>\n                                          </select>\n                                      </div>\n                                  </div>\n                              </div>\n                              <div class="d-flex justify-content-between align-items-center mb-2">\n                                  <label class="small fw-bold">Select Feedback (Up to 5):</label>\n                                  <span id="tagCounter" class="badge badge-primary">0/5 selected</span>\n                              </div>\n                              <div class="choice-grid mb-4">\n                                  ${choices.map((e=>`<div class="choice-tag" onclick="toggleTag(this, '${e}')">${e}</div>`)).join("")}\n                              </div>\n                              <div class="d-grid gap-2">\n                                  <button onclick="submitReview('${t.id}')" id="submitBtn" class="btn btn-primary shadow-0 py-2">POST REVIEW</button>\n                                  <button type="button" class="btn btn-danger btn-sm text-white" data-mdb-dismiss="modal">CANCEL</button>\n                              </div>\n                          </div>\n                      </div>`,document.querySelectorAll(".form-outline").forEach((e=>new mdb.Input(e).init())),myModal.show()}async function submitReview(e){const t=document.getElementById("submitBtn"),n=document.getElementById("stdId").value.trim(),s=selectedTags.join(", "),a=new Date,i=`${a.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/ /g,"-")} ${a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}`;if(n&&0!==selectedTags.length){t.innerText="Processing...",t.disabled=!0;try{const a=await fetch(SCRIPT_URL,{method:"POST",body:JSON.stringify({facultyId:e,studentId:n,user:document.getElementById("stdName").value.trim()||"Anonymous"+n.substring(0,2)+n.slice(-2),score:parseInt(document.getElementById("stdScore").value),text:s+"<p class='text-muted' style='font-size: 0.6em; margin:0;'>"+i+"</p>"})}),l=await a.text();"Success"===l?Swal.fire({icon:"success",title:"Review Posted!",text:"Thank you for your feedback.",showConfirmButton:!1,timer:2e3}).then((()=>location.reload())):"Duplicate"===l?(Swal.fire({icon:"error",title:"Denied",text:"You have already reviewed this teacher."}),resetBtn(t)):(Swal.fire({icon:"error",title:"Invalid ID",text:"This Student ID is not authorized."}),resetBtn(t))}catch(e){Swal.fire({icon:"error",title:"Error",text:"Could not connect to server."}),resetBtn(t)}}else Swal.fire({icon:"warning",title:"Missing Info",text:"Please provide your Student ID and select at least one feedback tag."})}function resetBtn(e){e.innerText="POST REVIEW",e.disabled=!1}document.addEventListener("DOMContentLoaded",(()=>{myModal=new mdb.Modal(document.getElementById("facultyModal")),fetchData()})),document.getElementById("searchInput").addEventListener("keyup",(function(){const e=this.value.toLowerCase();displayFaculty(facultyData.filter((t=>t.name.toLowerCase().includes(e)||t.dept.toLowerCase().includes(e))))}));
